/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 *
 * This file is a port of shadowCSS from `webcomponents.js` to TypeScript.
 * https://github.com/webcomponents/webcomponentsjs/blob/4efecd7e0e/src/ShadowCSS/ShadowCSS.js
 * https://github.com/angular/angular/blob/master/packages/compiler/src/shadow_css.ts
 */const w=t=>{const e=[];let o=0;return t=t.replace(/(\[[^\]]*\])/g,(n,a)=>{const c=`__ph-${o}__`;return e.push(a),o++,c}),{content:t.replace(/(:nth-[-\w]+)(\([^)]+\))/g,(n,a,c)=>{const l=`__ph-${o}__`;return e.push(c),o++,a+l}),placeholders:e}},L=(t,e)=>e.replace(/__ph-(\d+)__/g,(o,s)=>t[+s]),g="-shadowcsshost",E="-shadowcssslotted",b="-shadowcsscontext",H=")(?:\\(((?:\\([^)(]*\\)|[^)(]*)+?)\\))?([^,{]*)",P=new RegExp("("+g+H,"gim"),j=new RegExp("("+b+H,"gim"),v=new RegExp("("+E+H,"gim"),_=g+"-no-combinator",x=/-shadowcsshost-no-combinator([^\s]*)/,N=[/::shadow/g,/::content/g],M="([>\\s~+[.,{:][\\s\\S]*)?$",R=/-shadowcsshost/gim,O=t=>new RegExp(`((?<!(^@supports(.*)))|(?<={.*))(${t}\\b)`,"gim"),D=O("::slotted"),I=O(":host"),K=O(":host-context"),U=/\/\*\s*[\s\S]*?\*\//g,Y=t=>t.replace(U,""),A=/\/\*\s*#\s*source(Mapping)?URL=[\s\S]+?\*\//g,G=t=>t.match(A)||[],q=/(\s*)([^;\{\}]+?)(\s*)((?:{%BLOCK%}?\s*;?)|(?:\s*;))/g,z=/([{}])/g,F=/(^.*?[^\\])??((:+)(.*)|$)/,J="{",Q="}",S="%BLOCK%",$=(t,e)=>{const o=V(t);let s=0;return o.escapedString.replace(q,(...r)=>{const n=r[2];let a="",c=r[4],l="";c&&c.startsWith("{"+S)&&(a=o.blocks[s++],c=c.substring(S.length+1),l="{");const p=e({selector:n,content:a});return`${r[1]}${p.selector}${r[3]}${l}${p.content}${c}`})},V=t=>{const e=t.split(z),o=[],s=[];let r=0,n=[];for(let c=0;c<e.length;c++){const l=e[c];l===Q&&r--,r>0?n.push(l):(n.length>0&&(s.push(n.join("")),o.push(S),n=[]),o.push(l)),l===J&&r++}return n.length>0&&(s.push(n.join("")),o.push(S)),{escapedString:o.join(""),blocks:s}},X=t=>(t=t.replace(K,`$1${b}`).replace(I,`$1${g}`).replace(D,`$1${E}`),t),k=(t,e,o)=>t.replace(e,(...s)=>{if(s[2]){const r=s[2].split(","),n=[];for(let a=0;a<r.length;a++){const c=r[a].trim();if(!c)break;n.push(o(_,c,s[3]))}return n.join(",")}else return _+s[3]}),y=(t,e,o)=>t+e.replace(g,"")+o,Z=t=>k(t,P,y),T=(t,e,o)=>e.indexOf(g)>-1?y(t,e,o):t+e+o+", "+e+" "+t+o,tt=(t,e)=>{const o="."+e+" > ",s=[];return t=t.replace(v,(...r)=>{if(r[2]){const n=r[2].trim(),a=r[3],c=o+n+a;let l="";for(let d=r[4]-1;d>=0;d--){const u=r[5][d];if(u==="}"||u===",")break;l=u+l}const i=l+c,p=`${l.trimRight()}${c.trim()}`;if(i.trim()!==p.trim()){const d=`${p}, ${i}`;s.push({orgSelector:i,updatedSelector:d})}return c}else return _+r[3]}),{selectors:s,cssText:t}},et=t=>k(t,j,T),ot=t=>N.reduce((e,o)=>e.replace(o," "),t),nt=t=>{const e=/\[/g,o=/\]/g;return t=t.replace(e,"\\[").replace(o,"\\]"),new RegExp("^("+t+")"+M,"m")},st=(t,e)=>!nt(e).test(t),B=(t,e)=>t.replace(F,(o,s="",r,n="",a="")=>s+e+n+a),rt=(t,e,o)=>{if(R.lastIndex=0,R.test(t)){const s=`.${o}`;return t.replace(x,(r,n)=>B(n,s)).replace(R,s+" ")}return e+" "+t},ct=(t,e,o)=>{const s=/\[is=([^\]]*)\]/g;e=e.replace(s,(f,...h)=>h[0]);const r="."+e,n=f=>{let h=f.trim();if(!h)return"";if(f.indexOf(_)>-1)h=rt(f,e,o);else{const m=f.replace(R,"");m.length>0&&(h=B(m,r))}return h},a=w(t);t=a.content;let c="",l=0,i;const p=/( |>|\+|~(?!=))\s*/g;let u=!(t.indexOf(_)>-1);for(;(i=p.exec(t))!==null;){const f=i[1],h=t.slice(l,i.index).trim();u=u||h.indexOf(_)>-1;const m=u?n(h):h;c+=`${m} ${f} `,l=p.lastIndex}const C=t.substring(l);return u=u||C.indexOf(_)>-1,c+=u?n(C):C,L(a.placeholders,c)},lt=(t,e,o,s)=>t.split(",").map(r=>s&&r.indexOf("."+s)>-1?r.trim():st(r,e)?ct(r,e,o).trim():r.trim()).join(", "),W=(t,e,o,s,r)=>$(t,n=>{let a=n.selector,c=n.content;return n.selector[0]!=="@"?a=lt(n.selector,e,o,s):(n.selector.startsWith("@media")||n.selector.startsWith("@supports")||n.selector.startsWith("@page")||n.selector.startsWith("@document"))&&(c=W(n.content,e,o,s)),{selector:a.replace(/\s{2,}/g," ").trim(),content:c}}),it=(t,e,o,s,r)=>{t=X(t),t=Z(t),t=et(t);const n=tt(t,s);return t=n.cssText,t=ot(t),e&&(t=W(t,e,o,s)),t=t.replace(/-shadowcsshost-no-combinator/g,`.${o}`),t=t.replace(/>\s*\*\s+([^{, ]+)/gm," $1 "),{cssText:t.trim(),slottedSelectors:n.selectors}},at=(t,e,o)=>{const s=e+"-h",r=e+"-s",n=G(t);t=Y(t);const a=[];if(o){const l=i=>{const p=`/*!@___${a.length}___*/`,d=`/*!@${i.selector}*/`;return a.push({placeholder:p,comment:d}),i.selector=p+i.selector,i};t=$(t,i=>i.selector[0]!=="@"?l(i):((i.selector.startsWith("@media")||i.selector.startsWith("@supports")||i.selector.startsWith("@page")||i.selector.startsWith("@document"))&&(i.content=$(i.content,l)),i))}const c=it(t,e,s,r);return t=[c.cssText,...n].join(`
`),o&&a.forEach(({placeholder:l,comment:i})=>{t=t.replace(l,i)}),c.slottedSelectors.forEach(l=>{t=t.replace(l.orgSelector,l.updatedSelector)}),t};export{at as scopeCss};
//# sourceMappingURL=shadow-css-4f9ce44d-73a7c17a.js.map
